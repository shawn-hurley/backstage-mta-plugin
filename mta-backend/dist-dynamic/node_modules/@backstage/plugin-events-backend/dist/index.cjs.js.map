{"version":3,"file":"index.cjs.js","sources":["../src/service/EventsBackend.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  EventBroker,\n  EventPublisher,\n  EventSubscriber,\n} from '@backstage/plugin-events-node';\nimport { Logger } from 'winston';\nimport { DefaultEventBroker } from './DefaultEventBroker';\n\n/**\n * A builder that helps wire up all component parts of the event management.\n *\n * @public\n */\nexport class EventsBackend {\n  private eventBroker: EventBroker;\n  private publishers: EventPublisher[] = [];\n  private subscribers: EventSubscriber[] = [];\n\n  constructor(logger: Logger) {\n    this.eventBroker = new DefaultEventBroker(logger);\n  }\n\n  setEventBroker(eventBroker: EventBroker): EventsBackend {\n    this.eventBroker = eventBroker;\n    return this;\n  }\n\n  addPublishers(\n    ...publishers: Array<EventPublisher | Array<EventPublisher>>\n  ): EventsBackend {\n    this.publishers.push(...publishers.flat());\n    return this;\n  }\n\n  addSubscribers(\n    ...subscribers: Array<EventSubscriber | Array<EventSubscriber>>\n  ): EventsBackend {\n    this.subscribers.push(...subscribers.flat());\n    return this;\n  }\n\n  /**\n   * Wires up and returns all component parts of the event management.\n   */\n  async start(): Promise<void> {\n    this.eventBroker.subscribe(this.subscribers);\n    this.publishers.forEach(publisher =>\n      publisher.setEventBroker(this.eventBroker),\n    );\n  }\n}\n"],"names":["DefaultEventBroker"],"mappings":";;;;;;;;;;;;;;;AA6BO,MAAM,aAAc,CAAA;AAAA,EAKzB,YAAY,MAAgB,EAAA;AAJ5B,IAAQ,aAAA,CAAA,IAAA,EAAA,aAAA,CAAA,CAAA;AACR,IAAA,aAAA,CAAA,IAAA,EAAQ,cAA+B,EAAC,CAAA,CAAA;AACxC,IAAA,aAAA,CAAA,IAAA,EAAQ,eAAiC,EAAC,CAAA,CAAA;AAGxC,IAAK,IAAA,CAAA,WAAA,GAAc,IAAIA,gDAAA,CAAmB,MAAM,CAAA,CAAA;AAAA,GAClD;AAAA,EAEA,eAAe,WAAyC,EAAA;AACtD,IAAA,IAAA,CAAK,WAAc,GAAA,WAAA,CAAA;AACnB,IAAO,OAAA,IAAA,CAAA;AAAA,GACT;AAAA,EAEA,iBACK,UACY,EAAA;AACf,IAAA,IAAA,CAAK,UAAW,CAAA,IAAA,CAAK,GAAG,UAAA,CAAW,MAAM,CAAA,CAAA;AACzC,IAAO,OAAA,IAAA,CAAA;AAAA,GACT;AAAA,EAEA,kBACK,WACY,EAAA;AACf,IAAA,IAAA,CAAK,WAAY,CAAA,IAAA,CAAK,GAAG,WAAA,CAAY,MAAM,CAAA,CAAA;AAC3C,IAAO,OAAA,IAAA,CAAA;AAAA,GACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,KAAuB,GAAA;AAC3B,IAAK,IAAA,CAAA,WAAA,CAAY,SAAU,CAAA,IAAA,CAAK,WAAW,CAAA,CAAA;AAC3C,IAAA,IAAA,CAAK,UAAW,CAAA,OAAA;AAAA,MAAQ,CACtB,SAAA,KAAA,SAAA,CAAU,cAAe,CAAA,IAAA,CAAK,WAAW,CAAA;AAAA,KAC3C,CAAA;AAAA,GACF;AACF;;;;;;"}